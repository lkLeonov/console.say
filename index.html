
<style>
	body {
		margin: 0;
		text-align: center;
		display: -webkit-flex;
		-webkit-align-items: center;
		-webkit-flex-flow: column;
		-webkit-justify-content: center;
		position: absolute;
		height: 100%;
		width: 100%;
		left: 0;
		top: 0;
	}
	#info span {
		color: red;
	}
	#user img { 
		max-width: 200px; 
		margin: 1.5em;
	}
	#user div {
		font-size: x-large;
		margin-toP: .5em;
		font-style: italic;
	}

	#wrapper {
		border-radius: 2px;
		max-width: 640px;
		margin: .2em auto;
		padding: 1em;
		text-align: center;
		color: #777;
		box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
		transition: all .2s;
	}

	#wrapper:hover {
	  box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
		}

	button {
		display: none;
		cursor: pointer;
	    width: 5em;
	    height: 2em;
	    background: none;
	    outline: none;
	    border: 1px solid lightgrey;
	    margin: .5em auto;
	}
	button: hover {

	}

</style>
<body>
	<div id="wrapper">
		<div id="loading">Checking if logined</div>
		<div id="info"></div>
		<div id="user"></div>
		<button id="login">Login</button>
		<button id="logout">Logout</button>
	</div>

	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
	<script>
	var 
	 	$login = $('#login'),
	 	$logout = $('#logout'),
	 	$loading = $('#loading'),
	 	$info = $('#info'),
	    $user = $('#user');

	var storedUserData;

	var CONSOLE = {};
	CONSOLE.initial = console;
	CONSOLE.upgrade = function(userData, fbRef, styles) {
        var defaultStyles = 'font-family: Monospace; color: purple; font-size: 13px';
        styles = styles || defaultStyles;

        console.say = function(str) { 
            fbRef.push({
              text: " %c " + userData.name + ': %c' + str,
              user: userData.name,
              styles: styles
              
            });
          
        }
	  };

	  CONSOLE.restore = function() { 
	  	console.say = function() { console.info( 'You are not logged in! Log in' ) }
	  }

	   
	var DOM = {

	  isLogined: function(userData) {
	    $loading.hide(); // must be initial
	    $login.hide(); // if shown
	    $logout.show();
	    $info.html('You are logined via Google!' + '<span> + Go to console! + </span>');
	    $user.html('<div>' + userData.name + '</div>'); 
	    $('<img/>').attr('src', userData.photo).appendTo($user);
	    $user.show(); // if hidden
	  },

	  isNotLogined: function() {
	    $loading.hide(); // must be initial
	    $logout.hide(); // if shown
	    $login.show();
	    $info.text('You are logged out');
	    $user.hide(); // if shown
	  }
	}

		// Firebase
	  var FB_REFS = {};
	  FB_REFS.root = new Firebase("https://memoria.firebaseio.com");
	  FB_REFS.users = FB_REFS.root.child('users');
	  FB_REFS.messages = FB_REFS.root.child('messages');

	  FB_REFS.messages.on("child_added", function(snapshot, prevChildKey) {
	     var msg = snapshot.val();

	     /*	 msg
				{
				  "styles": "font-family: Arial; font-size: 2em;",
				  "text": " %c Алексей Леонов:%c text, ''",
				  "user": "Алексей Леонов"
				}
	     */

	    CONSOLE.initial.log(msg.text, msg.styles, 'font-size: 15px');
	  });
		// Base functions

			function checkIfExists(parentRef, key, callback) {
				parentRef.child(key).once('value', function(snapshot) {
					var val = snapshot.val();
		        	var exists = (val !== null);
		        	callback(key, exists, val)
				});
			}

			function googleAuth() {
				FB_REFS.root.authWithOAuthPopup("google", function(error, authData) {

				  if (error) {
				    console.info("Login Failed!", error);
				  } else {
				    console.info("Authenticated successfully with payload:", authData);
				  }
				});
			}

			// Auth callbacks

				// Register the callback to be fired every time auth state changes
				FB_REFS.root.onAuth(function(authData) {
					if (authData){ // logined
						console.info('Auth listener: Logged in...');
						console.log('%cUse \'console.say()\' command to say something...', 'color: purple; font-size: 2em; font-style: italic');
						DOM.isLogined({
						    name: authData.google.displayName,
						    photo: authData.google.profileImageURL
							});

						storedUserData = {
							name: authData.google.displayName,
							photo: authData.google.profileImageURL,
							uid: authData.uid
						}
	          
	          			CONSOLE.upgrade(storedUserData, FB_REFS.messages, null);
	          
						// save profile if not exists in fb					
						checkIfExists(FB_REFS.users, authData.uid, function(uid, exists){
							if (!exists) {
								FB_REFS.root.child("users").child(uid).set({
								  name: authData.google.displayName,
								  photo: authData.google.profileImageURL
								});
							}
						});
					} else {
						// not logined
						console.info('Auth listener: Not logged in...');
						CONSOLE.restore();
						DOM.isNotLogined();
					}
				});

	$login.click(function(){
	  googleAuth();
	});

	$logout.click(function(){
	  FB_REFS.root.unauth(function(){
	    //on logout callback
	  });
	});






	</script>
</body>